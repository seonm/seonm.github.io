name: Deploy to Repository B

# 'push' 이벤트가 발생할 때 트리거
on:
  push:
    branches:
      - main # main 브랜치에 푸시될 때 실행

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest

    steps:
      # 레포지토리 A 체크아웃
      - name: Checkout Repository A
        uses: actions/checkout@v3

      # Node.js 설정
      - name: Set up Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '20' # Node.js 버전을 프로젝트에 맞게 설정

      # Yarn 설치
      - name: Install Dependencies with Yarn
        run: yarn install

      # Next.js 빌드
      - name: Build Next.js App
        run: yarn build

      # 빌드 결과물을 배포할 레포지토리 B를 체크아웃
      - name: Checkout Repository B
        uses: actions/checkout@v3
        with:
          repository: seonm/seonm.github.io # B 레포지토리 경로
          token: ${{ secrets.PERSONAL_ACCESS_TOKEN }} # GitHub 토큰으로 인증
          path: B-repo # B 레포지토리의 배포 브랜치

      # B 레포지토리 기존 파일 삭제
      - name: Remove existing files from Repository B
        run: |
          rm -rf B-repo/*

      # 빌드된 파일을 레포지토리 B에 복사
      - name: Copy Build Files to Repository B
        run: |
          pwd
          ls -al
          cd ../
          ls -al
          cd wedding
          cp -r out/* B-repo/  # Next.js 빌드 파일 복사

      # B 레포지토리에 변경 사항 커밋 및 푸시
      - name: Commit and Push to Repository B
        run: |
          cd B-repo  # B Repository 디렉토리로 이동
          git config --global user.email "misoda1004@gmail.com"
          git config --global user.name "seonm"
          git add .
          git commit -m "Deploy from Repository A"
          git push origin main  # master 브랜치로 푸시
